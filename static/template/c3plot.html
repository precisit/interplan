
<form class="form-inline" name="plotSetup" ng-controller="c3PlotFormCtrl" ng-submit="postJobRequest()">
    <!--<pre>Model: {{departure| json}}</pre>
    <pre>Model: {{destination| json}}</pre>-->
    <div class="form-group" ng-class="{'has-success': departure['_id']}">
      <input class="form-control" name="departure" type="text" ng-model="departure" typeahead="object as object.full_name for object in objects($viewValue) | filter:$viewValue | limitTo:8" placeholder="Departure" required>
    </div>

    <div class="form-group" ng-class="{'has-success': destination['_id']}">
      <input class="form-control" name="destination" type="text" ng-model="destination" typeahead="object as object.full_name for object in objects($viewValue) | filter:$viewValue | limitTo:8" placeholder="Destination" required>
    </div>

    <div class="form-group" ng-class="{'has-error': plotSetup.start.$invalid}">
      <input class="form-control" name="start" data-provide="datepicker" placeholder="Depart window start" data-date-format="yyyy-mm-dd" ng-model="windowStart">
    </div>

    <div class="form-group" ng-class="{'has-error': plotSetup.stop.$invalid}">
      <input class="form-control" name="stop" data-provide="datepicker" placeholder="Depart window end" data-date-format="yyyy-mm-dd" ng-model="windowStop">
    </div>

    <div class="form-group" ng-class="{'has-error': plotSetup.minTT.$invalid}">
      <input class="form-control" name="minTT" type="number" ng-model="minTT" min="30" max="2000" step="10" required>
    </div>

    <div class="form-group" ng-class="{'has-error': plotSetup.maxTT.$invalid}">
      <input class="form-control" name="maxTT" type="number" ng-model="maxTT" min="60" max="2500" step="10" required>
    </div>

    <div class="form-group">
        <button type="submit" class="btn btn-primary" ng-disabled="plotSetup.$invalid">Plot C3</button>
    </div>
</form>

<!--Datepicker alternative: http://mgcrea.github.io/angular-strap/#/datepicker -->

<!--TODO: Figure out how to connect to jsFlow ANGULARTASTIC, figure out how to handle incoming data and generate plots -->

<div id="c3PlotArea" style="margin-top: 20px">
</div>

    <script type="text/javascript">

var w = 960,
    h = 500,
    alpha = 50,
    
    vertices = [[162, 332], [182, 299], [141, 292], [158, 264], [141, 408], [160, 400], [177, 430], [151, 442], [155, 425], [134, 430], [126, 447], [139, 466], [160, 471], [167, 447], [182, 466], [192, 442], [187, 413], [173, 403], [168, 425], [153, 413], [179, 275], [163, 292], [134, 270], [143, 315], [177, 320], [163, 311], [162, 281], [182, 255], [141, 226], [156, 235], [173, 207], [187, 230], [204, 194], [165, 189], [145, 201], [158, 167], [190, 165], [206, 145], [179, 153], [204, 114], [221, 138], [243, 112], [248, 139], [177, 122], [179, 99], [196, 82], [219, 90], [240, 75], [218, 61], [228, 53], [211, 34], [197, 51], [179, 65], [155, 70], [165, 85], [134, 80], [124, 58], [153, 44], [173, 34], [192, 27], [156, 19], [119, 32], [128, 17], [138, 36], [100, 58], [112, 73], [100, 92], [78, 100], [83, 78], [61, 63], [80, 44], [100, 26], [60, 39], [43, 71], [34, 54], [32, 90], [53, 104], [60, 82], [66, 99], [247, 94], [187, 180], [221, 168]],
    
    offset = function(a,dx,dy) {
        return a.map(function(d) { return [d[0]+dx,d[1]+dy]; });
    },
	
    dsq = function(a,b) {
        var dx = a[0]-b[0], dy = a[1]-b[1];
        return dx*dx+dy*dy;
    },
	
    asq = alpha*alpha,
	
    // well, this is where the "magic" happens..
    mesh = d3.geom.delaunay(offset(vertices,600,0)).filter(function(t) {
        return dsq(t[0],t[1]) < asq && dsq(t[0],t[2]) < asq && dsq(t[1],t[2]) < asq;
    });

var width = $('#c3PlotArea').width();
var aspect = 500/950;

var svg = d3.select("#c3PlotArea")
  .append("svg")
    .attr('preserveAspectRatio', 'xMidYMid')
    .attr('viewBox', '0 0 950 500')
    .attr("width", width)
    .attr("height", width*aspect)
    .attr("class", "Blues");

$(window).resize(function() {
  var width = $("#c3PlotArea").width();
  svg.attr("width", width);
  svg.attr("height", width * aspect);
});

svg.append("g")
  .selectAll("circle")
    .data(vertices)
  .enter().append("circle")
    .attr("r", 3)
    .attr("cx", function(d) { return d[0]; })
    .attr("cy", function(d) { return d[1]; });
    
svg.append("g")
  .selectAll("path")
    .data(d3.geom.delaunay(offset(vertices,300,0)))
  .enter().append("path")
    .attr("d", function(d) { return "M" + d.join("L") + "Z"; });

svg.append("g")
  .selectAll("path")
    .data(mesh)
  .enter().append("path")
    .attr("d", function(d) { return "M" + d.join("L") + "Z"; });

    </script>
